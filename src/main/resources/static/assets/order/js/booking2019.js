//ajax gbk
$.browser=$.browser||{};$.browser.mozilla=/firefox/.test(navigator.userAgent.toLowerCase());$.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase());$.browser.opera=/opera/.test(navigator.userAgent.toLowerCase());$.browser.msie=/msie/.test(navigator.userAgent.toLowerCase());jQuery.param=function(b){function a(a,b){d[d.length]=c(a)+"\x3d"+c(b)}var d=[],c=function(a){a=escape(a);return a=a.replace(/\+/g,"%u002B")};if(jQuery.isArray(b)||b.jquery)jQuery.each(b,function(){a(this.name,this.value)});else for(var e in b)jQuery.isArray(b[e])?jQuery.each(b[e],function(){a(e,this)}):a(e,jQuery.isFunction(b[e])?b[e]():b[e]);return d.join("\x26").replace(/%20/g,"+")};function compareBirthDate(b,a){var d=b.split("-"),c=d[0],e=d[1],d=d[2],h=a.split("-"),n=h[0],t=h[1],h=h[2];if(c<n)return-1;if(c>n)return 1;if(c==n){if(e<t)return-1;if(e>t)return 1;if(e==t){if(d<h)return-1;if(d>h)return 1;if(d==h)return 0}}}function checkIdCardRule(b){b=String(b);var a={msg:"",rst:!0},d=b.length;if(15!=d&&18!=d)return a.msg="\u8bc1\u4ef6\u53f7\u7801\u4f4d\u6570\u4e0d\u6b63\u786e",a.rst=!1,a;var c,e;15==d?/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/.test(b)?(c=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/),e=b.match(c),c=new Date("19"+e[2]+"/"+e[3]+"/"+e[4]),e=c.getYear()==Number(e[2])&&c.getMonth()+1==Number(e[3])&&c.getDate()==Number(e[4])):(a.msg="\u8bc1\u4ef6\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e",a.rst=!1):18==d&&(/^(\d{6})(19|20)?(\d{2})([01]\d)([0123]\d)(\d{3})(\d|X|x)?$/.test(b)?(c=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X|x)$/),e=b.match(c),c=new Date(e[2]+"/"+e[3]+"/"+e[4]),e=c.getFullYear()==Number(e[2])&&c.getMonth()+1==Number(e[3])&&c.getDate()==Number(e[4])):(a.msg="\u8bc1\u4ef6\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e",a.rst=!1));if(e){e=(new Date).getFullYear();var h=(new Date).getMonth(),n=(new Date).getDate();if(0>compareBirthDate(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDate(),e-102+"-"+h+"-"+n)||0<compareBirthDate(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDate(),e+"-"+h+"-"+n))a.msg="\u8bc1\u4ef6\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e",a.rst=!1;else if(15!=d){null=={11:"\u5317\u4eac",12:"\u5929\u6d25",13:"\u6cb3\u5317",14:"\u5c71\u897f",15:"\u5185\u8499\u53e4",21:"\u8fbd\u5b81",22:"\u5409\u6797",23:"\u9ed1\u9f99\u6c5f",31:"\u4e0a\u6d77",32:"\u6c5f\u82cf",33:"\u6d59\u6c5f",34:"\u5b89\u5fbd",35:"\u798f\u5efa",36:"\u6c5f\u897f",37:"\u5c71\u4e1c",41:"\u6cb3\u5357",42:"\u6e56\u5317",43:"\u6e56\u5357",44:"\u5e7f\u4e1c",45:"\u5e7f\u897f",46:"\u6d77\u5357",50:"\u91cd\u5e86",51:"\u56db\u5ddd",52:"\u8d35\u5dde",53:"\u4e91\u5357",54:"\u897f\u85cf",61:"\u9655\u897f",62:"\u7518\u8083",63:"\u9752\u6d77",64:"\u5b81\u590f",65:"\u65b0\u7586",71:"\u53f0\u6e7e",81:"\u9999\u6e2f",82:"\u6fb3\u95e8",91:"\u56fd\u5916"}[parseInt(b.substr(0,2))]&&(a.msg="\u8bc1\u4ef6\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e",a.rst=!1);d=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2];for(e=c=0;e<b.length-1;e++)c+=parseInt(b.substr(e,1),10)*d[e];[1,0,"X",9,8,7,6,5,4,3,2][c%11]!=b.substr(17,1).toUpperCase()&&(a.msg="\u8bc1\u4ef6\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e",a.rst=!1)}}else a.msg="\u8bc1\u4ef6\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e",a.rst=!1;return a}function getBirthdayByIdCard(b){var a=String(b).replace(/\s/g,""),d=a.length;b="";if(15!=d&&18!=d)return!1;if(15==d)if(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/.test(a))reg=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/),cardNoSplit=a.match(reg),b=new Date("19"+cardNoSplit[2]+"/"+cardNoSplit[3]+"/"+cardNoSplit[4]);else return!1;else if(18==d)if(/^(\d{6})(19|20)?(\d{2})([01]\d)([0123]\d)(\d{3})(\d|X|x)?$/.test(a))reg=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X|x)$/),cardNoSplit=a.match(reg),b=new Date(cardNoSplit[2]+"/"+cardNoSplit[3]+"/"+cardNoSplit[4]);else return!1;a=b.getMonth()+1;d=b.getDate();10>a&&(a="0"+a);10>b.getDate()&&(d="0"+b.getDate());return b.getFullYear()+"-"+a+"-"+d}function getGenderByIdCard(b){b=String(b);var a=b.replace(/\s/g,"");b=b.length;return 18==b?1==parseInt(a.substr(16,1))%2?"\u7537":"\u5973":15==b?1==parseInt(a.substr(13,1))%2?"\u7537":"\u5973":!1}function delete_tr(b){b=$(b).parent();b.data("id");b.find(".fullname input").val();var a=b.find(".idcard input").val();$(".choice_often input").each(function(b,c){$(c).data("idcard")==a&&$(c).prop("checked",!1)});b.remove();auto_isfree();loadprices(5,$("#RoomId").val(),$("#RentCount").val(),$("#start_date").val(),$("#end_date").val(),$("#RentNumber").val(),$("#BonusId").val(),$("#usezubi").val(),getCheckedUser($('[name\x3d"fullname"]')),getCheckedUser($('[name\x3d"idcard"]')))}function clear_tr(b){b=$(b).parent();b.data("id");b.find(".fullname input").val();var a=b.find(".idcard input").val();$(".choice_often input").each(function(b,c){$(c).data("idcard")==a&&$(c).prop("checked",!1)});b.find(".fullname input").val("");b.find(".idcard input").val("");b.find(".infor_gender").html("-");b.find(".birthday").html("-");b.find(".delete").attr("onclick","clear_tr(this)").html("\u6e05\u7a7a");loadprices(51,$("#RoomId").val(),$("#RentCount").val(),$("#start_date").val(),$("#end_date").val(),$("#RentNumber").val(),$("#BonusId").val(),$("#usezubi").val(),getCheckedUser($('[name\x3d"fullname"]')),getCheckedUser($('[name\x3d"idcard"]')))}function auto_isfree(){$(".check_infor .add_infor").each(function(a,b){1<$(".check_infor .add_infor").size()?$(b).find(".delete").attr("onclick","delete_tr(this)").html("\u5220\u9664"):$(b).find(".delete").attr("onclick","clear_tr(this)").html("\u6e05\u7a7a");$(b).find(".insur").html("\u514d\u8d39\u8d60\u9001")});var b=Math.round($("#daynum").val()),b=Math.round($(".daynum").html()),a=$(".check_infor .add_infor").size(),d=0;0==a?add_person():1<a?($("#check_insurance").prop("checked")||(a=1),d=a-1):$("#check_insurance").prop("checked")||(a=1);d=b*d*.2;$("#Insurance").val(d);a="";$("#check_insurance").prop("checked")&&(a='\uff08\x3cfont style\x3d"color:#52a7ff;"\x3e\u8d60\u9001\uffe5'+S.toDecimal(b,2)+"\x3c/font\x3e\uff09");b=$(".detail_list li").eq(3);b.find(".d_l").eq(1).html('\x3cspan class\x3d"fr"\x3e+\uffe5'+S.toDecimal(d,2)+"\x3c/span\x3e"+S.toDecimal(d,2)+"\u00d71");b.find(".l_money").html("+\uffe5"+S.toDecimal(d)+""+a)}function check_use(){}function add_person(b,a,d,c,e,h){b=b||"";a='\x3cdiv class\x3d"fullname"\x3e\x3cinput type\x3d"text" name\x3d"fullname" value\x3d"'+(a||"")+'" onkeyup\x3d"rp_background(this);" onpaste\x3d"rp_background(this);" maxlength\x3d"10" value\x3d""\x3e\x3c/div\x3e\x3cdiv class\x3d"idcard"\x3e\x3cinput type\x3d"text" name\x3d"idcard" maxlength\x3d"18" value\x3d"'+(d||"")+'"\x3e\x3c/div\x3e\x3cdiv class\x3d"infor_gender" style\x3d"padding: 5px 0;"\x3e'+(c||"-")+'\x3c/div\x3e\x3cdiv class\x3d"birthday" style\x3d"padding: 5px 0;"\x3e'+(e||"-")+'\x3c/div\x3e\x3cdiv class\x3d"insur"\x3e'+(h||"")+'\x3c/div\x3e\x3cdiv class\x3d"delete" onclick\x3d"clear_tr($(this))"\x3e\u6e05\u7a7a\x3c/div\x3e';$("\x3cli/\x3e").addClass("add_infor clear").data("id",b).html(a).appendTo($(".check_infor ul"));$(".idcard input[name\x3d'idcard']").off().on("input propertychange",function(){var a=$(this).get(0);rp_numx(a);keyup_tr(a)});auto_isfree()}function keyup_tr(b){var a=$(b).val(),d=$(b).parent().find(".erro"),c=$(b).parent().parent().find(".infor_gender");b=$(b).parent().parent().find(".birthday");var e=getGenderByIdCard(a)||"",h=getBirthdayByIdCard(a)||"",a=checkIdCardRule(a);if(a.rst){if(d.hide(),c.html(e),b.html(h),""!=e&&""!=h){d=getCheckedUser($('[name\x3d"fullname"]')).split(",");c=getCheckedUser($('[name\x3d"idcard"]')).split(",");for(a=0;a<c.length;a++)if(15>c[a].length)return;for(a=0;a<d.length;a++)if(""==d[a])return;d.length==c.length&&loadprices(2,$("#RoomId").val(),$("#RentCount").val(),$("#start_date").val(),$("#end_date").val(),$("#RentNumber").val(),$("#BonusId").val(),$("#usezubi").val(),getCheckedUser($('[name\x3d"fullname"]')),getCheckedUser($('[name\x3d"idcard"]')))}}else c.html("-"),b.html("-"),d.html('\x3cdiv class\x3d"zi"\x3e'+(a.msg||"")+'\x3c/div\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"try{S(this).parent().hide();}catch(e){}"\x3eX\x3c/a\x3e'),d.show()}function rp_background(b){var a=String($(b).val());if(-1<a.indexOf(" ")||-1<a.indexOf("\u3000"))a=a.replace(/[\ \\u3000]/gi,""),$(b).val(a)}function rp_numx(b){var a=String($(b).val());/[^0-9xX]/.test(a)&&(a=a.replace(/[^0-9xX]/gi,""),$(b).val(a))}$(".count_open").each(function(b,a){$(a).children("span").on("click",function(){"none"==$(".discount").eq(b).css("display")?($(".discount").eq(b).show(),$(a).find("i.open_icon").css("background","url(http://www.muniao.com/demotest/order/images/order_icon.png) no-repeat -25px -21px")):($(".discount").eq(b).hide(),$(a).find("i.open_icon").css("background","url(http://www.muniao.com/demotest/order/images/order_icon.png) no-repeat -25px 0px"));180<$(".voucher_list").height()?$(".voucher_list").css({height:"180px"}):$(".voucher_list").css({height:"inherit"})})});$(".count_open").each(function(b,a){$(a).children(".count_h").on("mouseover",function(){$(a).children(".see_details").show()});$(a).children(".count_h").on("mouseout",function(){$(a).children(".see_details").hide()})});$(".activation_conpon").click(function(){"block"==$(".activ_code").css("display")?$(".activ_code").css("display","none"):$(".activ_code").css("display","block")});var timer=null;$("div.see_xq").each(function(b,a){$(a).on("mouseover",function(){$(a).children("div.see_details").show();$(a).parents("li").siblings().find(".see_details").hide();clearInterval(timer)});$(a).on("mouseout",function(){timer=setTimeout(function(){$(a).children("div").hide()},1E3)})});var order_r=document.getElementById("order_r"),order_content=document.getElementById("order_content"),tnum=0;window.onscroll=fix;fix();function fix(){var b=$("body").height()-$(".s_mn_footerbox").height(),a=document.documentElement.srcollTop||document.body.scrollTop;a>order_r.offsetTop&&a<=b-$("#order_r").height()?(order_r.style.position="fixed",order_r.style.top="0",order_r.style.left=order_content.offsetLeft+900+"px",order_r.style.marginTop="0"):a>=b-$("#order_r").height()?(tnum=-a+b-$("#order_r").height()-100,$("#order_r").css("top",tnum+"px")):(order_r.style.position="static",order_r.style.marginTop="35px")}$(".zb_num").on("focus",function(){"\u8bf7\u8f93\u5165\u9700\u8981\u4f7f\u7528\u7684\u79df\u5e01\u6570"==$(this).val()&&$(this).val("")});$(".zb_num").on("blur",function(){""==$(this).val()&&$(this).val("\u8bf7\u8f93\u5165\u9700\u8981\u4f7f\u7528\u7684\u79df\u5e01\u6570")});$(".jf_num").on("focus",function(){"\u8bf7\u8f93\u5165\u9700\u8981\u4f7f\u7528\u7684\u79ef\u5206"==$(this).val()&&$(this).val("")});$(".jf_num").on("blur",function(){""==$(this).val()&&$(this).val("\u8bf7\u8f93\u5165\u9700\u8981\u4f7f\u7528\u7684\u79ef\u5206")});$(document).ready(function(){function b(){var a=[];$(".choice_often input").each(function(b,d){var c=$(d).data("id"),e=$(d).data("idcard"),f=$(d).data("fullname");$(d).data("idtype");$(d).data("verified");var h=getGenderByIdCard(e),n=getBirthdayByIdCard(e),l="\u514d\u8d39\u8d60\u9001",m=[];if(!e)return!0;if($(d).prop("checked")){var k=!0;$(".check_infor .add_infor").each(function(a,b){var d=$(b).find(".idcard input").val(),c=$(b).find(".fullname input").val();d?m.push(d):$(b).remove();d==e&&c==f&&(k=!1)});0==m.length&&($(".check_infor .add_infor").remove(),l="\u514d\u8d39\u8d60\u9001");k&&add_person(c,f,e,h,n,l)}else a.push(e),$(".check_infor .add_infor").each(function(a,b){var d=$(b).find(".idcard input").val(),c=$(b).find(".fullname input").val();d==e&&c==f&&$(b).remove()})});auto_isfree();loadprices(10,$("#RoomId").val(),$("#RentCount").val(),$("#start_date").val(),$("#end_date").val(),$("#RentNumber").val(),$("#BonusId").val(),$("#usezubi").val(),getCheckedUser($('[name\x3d"fullname"]')),getCheckedUser($('[name\x3d"idcard"]')))}var a=$("#RoomId").val(),d="",c="",e=Math.round($("#roomnumber").val().split("\u5957")[0]),h=Math.round($("#minNights").val()),n=Math.round($("#maxNights").val()),t=$("#danweitext").val();0>=n&&(n=365);(function(b,k){function f(){$(".day li").each(function(b,a){$(a).on("mouseover",function(){$(a).children("div").show();$(a).siblings().children("div").hide();$(a).children("div").addClass("tips")});$(a).on("mouseout",function(){$(a).children("div").hide();$(a).children("div").removeClass("tips")})});$(".day a").each(function(a,b){});$(".day a").each(function(a,f){$(f).on("click",function(){""==d?(d=$(f).data("datestr"),c="",q(m,e,d,c)):(c=$(f).data("datestr"),d==c?(c=d="",q(m,e)):d!=c?(c=$(f).data("datestr"),q(m,e,d,c)?d&&c&&(v(m,e,d,c),$("#"+b+"").val(d),$("#"+b+"_s").val(d),$("#"+k+"").val(c),$("#"+k+"_s").val(c),loadprices(7,$("#RoomId").val(),$("#RentCount").val(),$("#start_date").val(),$("#end_date").val(),$("#RentNumber").val(),$("#BonusId").val(),$("#usezubi").val(),getCheckedUser($('[name\x3d"fullname"]')),getCheckedUser($('[name\x3d"idcard"]'))),c=d="",$(".date_wrap").hide(),q(m,e)):c=""):c="")})})}function D(){$(".day li").each(function(a,b){$(b).off("mouseover");$(b).off("mouseout")});$(".day a").each(function(a,b){});$(".day a").each(function(a,b){$(b).off("click")})}function v(a,b,d,c){d=Number(String(d||"").replace(/\-/gi,""));c=Number(String(c||"").replace(/\-/gi,""));b=Number(b);if(!(!d||!c&&d>=c)){var e=0,f=0;a=0;l.forEach(function(a,g){a.list&&a.list.length&&a.list.forEach(function(a,g){var z=Number(a.year+""+a.month+""+a.date+"");0==a.before&&a.sameroom>=b&&z>=d&&z<c&&(e+=a.priceday,f++)})});0<e&&(a=Math.round(e/f),$(".order_right_pir span").html("\uffe5"+a))}}function q(a,b,e,r,p){b="number"==typeof b?Number(b):1;p=e;var g=r;e=Number(String(e||"").replace(/\-/gi,""));r=Number(String(r||"").replace(/\-/gi,""));var k;e&&r&&e>=r&&(e=r,r=0,d=c,c="");if(e&&r){console.log(e+"|"+r);if(Math.round((Date.parse(S.NewDate(g))-Date.parse(S.NewDate(p)))/864E5)<h){c="";alert("\u8be5\u623f\u6e90\u6700\u5c11\u5165\u4f4f"+h+"\u5929\uff01");return}if(Math.round((Date.parse(S.NewDate(g))-Date.parse(S.NewDate(p)))/864E5)>n){c="";alert("\u8be5\u623f\u6e90\u6700\u591a\u5165\u4f4f"+n+"\u5929\uff01");return}}if(!(0>a||a>l.length-2)){D();m=a;var C=$(".date_wrap .month").eq(0),q=$(".date_wrap .month").eq(1),w=l[m],t=l[m+1],u="",v=0,z=0,y=0,x=-1;[0,1].forEach(function(a,d){var f=0==d?w:t;u="";for(var g=0;g<f.list.length;g++){k=Number(f.list[g].year+""+f.list[g].month+""+f.list[g].date+"");y=z=v=0;k==e?z=v=1:k==r?y=v=1:k>e&&k<r&&(v=1);if(0==g)if(0==d){if(0<e&&e<f.start)for(var p=0;p<l.length;p++)e<=l[p].end&&e>=l[p].start&&l[p].dateno>=e&&(x=-2);if(0!=f.list[g].day)for(p=0;p<f.list[g].day;p++)u+="\x3cli\x3e\x3c/li\x3e"}else if(0!=t.list[g].day)for(p=0;p<t.list[g].day;p++)u+="\x3cli\x3e\x3c/li\x3e";if(f.list[g].before)u+="\x3cli\x3e"+f.list[g].date+"\x3c/li\x3e";else if(k<e&&(""==c||0==d))u+='\x3cli class\x3d"rental"\x3e'+f.list[g].date+"\x3cem\x3e\u4e0d\u53ef\u9009\x3c/em\x3e\x3c/li\x3e";else{-1==x&&(x=f.list[g].sameroom);if(-2==x)u+='\x3cli class\x3d"rental"\x3e'+f.list[g].date+"\x3cem\x3e\u4e0d\u53ef\u9009\x3c/em\x3e\x3c/li\x3e";else if(0!=x&&f.list[g].sameroom<b&&k>e&&0!=e&&0==r||0==x&&e&&k>e)u+='\x3cli\x3e\x3ca href\x3d"javascript:void(0);"'+(v?' class\x3d"day_hover"':"")+' data-datestr\x3d"'+f.list[g].year+"-"+f.list[g].month+"-"+f.list[g].date+'"\x3e'+f.list[g].date+"\x3cem\x3e\u53ef\u9000\u623f\x3c/em\x3e\x3c/a\x3e\x3c/li\x3e",x=-2;else if(f.list[g].sameroom<b&&r!=k){if(1==v){alert(f.list[g].year+"-"+f.list[g].month+"-"+f.list[g].date+"\u5df2\u51fa\u79df");return}u+='\x3cli class\x3d"rental"\x3e'+f.list[g].date+"\x3cem\x3e\u5df2\u51fa\u79df\x3c/em\x3e\x3c/li\x3e"}else u+='\x3cli\x3e\x3ca href\x3d"javascript:void(0);"'+(v?' class\x3d"day_hover"':"")+' data-datestr\x3d"'+f.list[g].year+"-"+f.list[g].month+"-"+f.list[g].date+'"\x3e'+(1==z?"\u5165\u4f4f":1==y?"\u79bb\u5e97":f.list[g].date)+"\x3cem\x3e\uffe5"+f.list[g].priceday+"\x3c/em\x3e\x3c/a\x3e\x3c/li\x3e";-2!=x&&(x=f.list[g].sameroom)}}0==d?(C.find(".date_title").html(w.month),C.find(".day").html(u)):(q.find(".date_title").html(t.month),q.find(".day").html(u))});f();return!0}}function w(a){if(!(0>a||a>l.length-1)){y=a;$(".date_wrap .month").eq(0);a=l[y];for(var b="",d=$(".sche_Rback").data("today"),e,c=0;c<a.list.length;c++){e=d==a.list[c].year+"-"+a.list[c].month+"-"+a.list[c].date?1:0;if(0==c&&0!=a.list[c].day)for(var f=0;f<a.list[c].day;f++)b+='\x3cli class\x3d"sche_none"\x3e\x3cp class\x3d"sche_gray"\x3e\x26nbsp;\x3c/p\x3e\x3cp class\x3d"sche_gray"\x3e\x3c/p\x3e\x3cp class\x3d"sche_gray"\x3e\x3c/p\x3e\x3c/li\x3e';b=a.list[c].before?b+('\x3cli class\x3d"sche_none"\x3e\x3cp class\x3d"sche_gray"\x3e'+a.list[c].date+'\x3c/p\x3e\x3cp class\x3d"sche_gray"\x3e\x3c/p\x3e\x3cp class\x3d"sche_gray"\x3e\x3c/p\x3e\x3c/li\x3e'):0==a.list[c].sameroom?b+('\x3cli class\x3d"sche_none'+(1==e?" sche_today":"")+'"\x3e\x3cp class\x3d"sche_gray"\x3e'+a.list[c].date+'\x3c/p\x3e\x3cp class\x3d"sche_gray"\x3e\x3c/p\x3e\x3cp class\x3d"sche_gray"\x3e\x3c/p\x3e\x3c/li\x3e'):b+("\x3cli"+(1==e?' class\x3d"sche_today"':"")+' data-datestr\x3d"'+a.list[c].year+"-"+a.list[c].month+"-"+a.list[c].date+'"\x3e\x3cp class\x3d"sche_day"\x3e'+a.list[c].date+'\x3c/p\x3e\x3cp class\x3d"sche_gray"\x3e\u5269'+a.list[c].sameroom+""+t+'\x3c/p\x3e\x3cp class\x3d"sche_gray"\x3e\uffe5'+a.list[c].priceday+"\x3c/p\x3e\x3c/li\x3e")}$(".sche_month").html(a.month);$(".sche_daybox").html(b)}}function B(){A=1;$.ajax({url:"/Home/GetCalender?RoomId\x3d"+a+"",type:"POST",data:"",success:function(a){a=JSON.parse(a);jsonStr=a.jsonStr;A=2;$(".BMap_noprint").eq(-1).hide();if(0==a.status){l=a.month_list;v(0,$("#roomnumber").val().split("\u5957")[0],$("#"+b).val(),$("#"+k).val());m=0;q(0,e);w(0);var c=[];a="";l[0].list.forEach(function(a,b){if(4<c.length)return!1;a.before||(a.sameroom?c.push("\x3cli\x3e\x3cp\x3e"+a.date+"\x3c/p\x3e\x3cp\x3e\uffe5"+a.priceday+"\x3c/p\x3e\x3c/li\x3e"):c.push("\x3cli\x3e\x3cp\x3e"+a.date+"\x3c/p\x3e\x3cp\x3e\u5df2\u79df\x3c/p\x3e\x3c/li\x3e"));return!1});for(var d=0;d<c.length-6;d++)a+="\x3cli\x3e\x3c/li\x3e";a+=c.join("");a+='\x3cli class\x3d"border_R"\x3e\x3ca href\x3d"javascript:void(0);"\x3e\x3cp\x3e\u5168\u90e8\x3c/p\x3e\x3cp\x3e\u65e5\u5386\x3c/p\x3e\x3c/a\x3e\x3c/li\x3e';$(".room_Rpq").html(a);$(".room_Rpq").show();$(".border_R").click(function(){$("#shedulebg").show()})}},error:function(a){}})}var l=[],m=0,y=0,A=0;$(".date_pre").click(function(){l.length&&q(m-1,e,d,c,!1)});$(".date_next").click(function(){l.length&&q(m+1,e,d,c,!0)});$("#xl_show1 a").click(function(){$("#fjs").val($(this).data("num")+($("#danweitext").val()||""));e=Math.round($(this).data("num"));q(m,e,d,c);$("#roomnumber").val($(this).data("num"));$("#xl_show1").hide()});$("#"+b+"").click(function(){0==A&&B();$(".person_menu").hide();$(".room_menu").hide();$(".date_wrap").show()});$("#"+k+"").click(function(){0==A&&B();$(".person_menu").hide();$(".room_menu").hide();$(".date_wrap").show()});$(".sche_pre2").click(function(){l.length&&w(y-1)});$(".sche_next2").click(function(){l.length&&w(y+1)});$(".sche_Rback").click(function(){w(0)});$(document).click(function(a){a=$(a.target);0==a.closest(".date_wrap,#"+b+",#"+k+",.month").length&&0!=a.closest("body").length&&(c=d="",q(m,e),$(".date_wrap").hide());0==a.closest(".schedulebox,.border_R,.schedule,.sche_right").length&&$("#shedulebg").hide();0==a.closest("#xl_show1,#fjs").length&&$("#xl_show1").hide();0==a.closest("#x2_show2,#frs").length&&$("#x2_show2").hide();0==a.closest(".c_roomnumber,.room_menu").length&&$(".room_menu").hide();0==a.closest(".c_rentnumber,.person_menu").length&&$(".person_menu").hide()});B();$("#rentnumber").on("focus",function(){$(".room_menu").hide();c=d="";$(".date_wrap").hide();q(m,e);$(".person_menu").show()});$("#roomnumber").on("focus",function(){$(".person_menu").hide();c=d="";$(".date_wrap").hide();q(m,e);$(".room_menu").show()})})("start_date","end_date");$("#roomnumber").on("blur",function(){});$(".room_menu a").each(function(a,b){$(b).on("click",function(){var a=$(this).data("num"),b=$(this).html();$("#roomnumber").val(b);$("#RentCount").val(a);$("#em_RentCount").html(a);$(".room_menu").hide();loadprices(8,$("#RoomId").val(),$("#RentCount").val(),$("#start_date").val(),$("#end_date").val(),$("#RentNumber").val(),$("#BonusId").val(),$("#usezubi").val(),getCheckedUser($('[name\x3d"fullname"]')),getCheckedUser($('[name\x3d"idcard"]')))})});$(".person_menu a").each(function(a,b){$(b).on("click",function(){var a=$(this).data("num"),b=$(this).html();$("#rentnumber").val(b);$("#RentNumber").val(a);$("#em_RentNumber").html(a);$(".person_menu").hide();loadprices(9,$("#RoomId").val(),$("#RentCount").val(),$("#start_date").val(),$("#end_date").val(),$("#RentNumber").val(),$("#BonusId").val(),$("#usezubi").val(),getCheckedUser($('[name\x3d"fullname"]')),getCheckedUser($('[name\x3d"idcard"]')))})});$(".choice_often input").each(function(a,c){$(c).on("change",b)})});Date.prototype.diff=function(b){return(this.getTime()-b.getTime())/864E5};Date.prototype.format=function(b){var a={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in a)(new RegExp("("+d+")")).test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?a[d]:("00"+a[d]).substr((""+a[d]).length)));return b};function getCheckedUser(b){for(var a="",d=0;d<b.length;d++)var c=$(b[d]).val(),a=""==a?a+c:a+(","+c);return a}var jsonStr="";function loadprices(b,a,d,c,e,h,n,t,w,k){$.post("/home/checkordernew",{i_id:a,number:d,start_date:c,end_date:e,rentnumber:h,bonus_id:n,use_accounts:t,fullname:w,idcard:k},function(a){a=JSON.parse(a);if(0<a.code)alert(a.message),121==a.code&&($("#usezubi").val(0),$("#li_zubi").hide(),$("#li_zubi em").html(0));else{$(".totalprice").html("\uffe5"+a.totalprice);var b=toDecimal(parseFloat(a.payment_price||0)+parseFloat(a.insurance_price||0)+parseFloat(a.inshop_pay||0));$("#lb_Amount").html("\uffe5"+b);$("#lb_BAmount").html("\uffe5"+a.payment_price);$("#lb_Insurance").html(a.insurance_price);$("#lb_Bonus").html(a.bonus_price);$("#lb_RentMoney").html(a.accounts_price);$("#lb_DaoDianPrice").html(a.inshop_pay);$("#div_order_detail").html("");for(var d=0;d<a.info.length;d++)$("#div_order_detail").append('\x3cul class\x3d"clear"\x3e\x3cli\x3e'+a.info[d].date+'\x3c/li\x3e\x3cli title\x3d"'+$("#Title").val()+'"class\x3d"room_name"\x3e'+$("#Title").val()+"\x3c/li\x3e\x3cli\x3e\x3cspan\x3e"+a.number+"\x3c/span\x3e\u5957\x3c/li\x3e\x3cli\x3e\uffe5\x3clabel\x3e"+a.info[d].price+"\x3c/label\x3e\x3c/li\x3e\x3c/ul\x3e");$("#sp_baoxian").html("+\uffe5"+a.insurance_price+'\uff08\x3cfont style\x3d"color:#52a7ff;"\x3e\u8d60\u9001\x3c/font\x3e\uff09');0<a.accounts_price?($("#li_zubi").show(),$("#li_zubi em").html("-\uffe5"+a.accounts_price)):($("#li_zubi").hide(),$("#li_zubi em").html(0));0<a.bonus_price?($(".count_tip").html($(this).find(".vou_pirce").html()),$("#a_quxiao").show(),$("#li_youhui").show(),$("#li_youhui span:eq(1)").html("-\uffe5"+a.bonus_price)):($("#a_quxiao").hide(),$(".count_tip").html(""),$(".voucher_list input").removeAttr("checked"),$("#li_youhui").hide(),$("#li_youhui em").html(""),$("#BonusId").val(0));$("#em_startdate").html(c);$("#em_enddate").html(e);$(".daynum").html(a.days);$("#taoshu").html(a.number);$("#em_needprice").html(a.prepay_price);$("#em_bottom_needprice").html(a.prepay_price);$(".has_discount").html(a.bonus_price);$("#UserAllRentMoney").val()>=b-parseFloat(a.inshop_pay||0)?$(".accounts_num").html(toDecimal(b-parseFloat(a.inshop_pay||0))):$(".accounts_num").html(toDecimal($("#UserAllRentMoney").val()));$("#StartDate").val(c);$("#EndDate").val(e);$("#Amount").val(a.prepay_price);$("#TAmount").val(a.totalprice);$("#BAmount").val(a.payment_price);$("#Insurance").val(a.insurance_price);$("#Bonus").val(a.bonus_price);$("#RentMoneyAccounts").val(a.accounts_price)}})}function getBonusList(b){$.post("/Home/GetBonusList",{TAmount:b},function(a){$("#ul_bonuslist").html(a);$(".bonus_num").html($("#ul_bonuslist li").length)})}function validateNum(b){return/^[0-9]+(.[0-9]{1,2})?$/.test(b.value)&&/^[0-9]+(.[0-9]{1,2})?$/.test(b.value)?!0:!1}function toDecimal(b){var a=parseFloat(b);if(isNaN(a))return!1;a=Math.round(100*b)/100;b=a.toString();a=b.indexOf(".");0>a&&(a=b.length,b+=".");for(;b.length<=a+2;)b+="0";return b}function IdentityCodeValid(b){b=String(b);b=b.toUpperCase();if(!/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(b))return!1;var a;a=b.length;if(15==a){a=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/);a=b.match(a);var d=new Date("19"+a[2]+"/"+a[3]+"/"+a[4]);if(a=d.getYear()==Number(a[2])&&d.getMonth()+1==Number(a[3])&&d.getDate()==Number(a[4])){a=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2];var c=0,e;b=b.substr(0,6)+"19"+b.substr(6,b.length-6);for(e=0;17>e;e++)c+=b.substr(e,1)*a[e];return!0}return!1}if(18==a&&(a=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/),a=b.match(a),d=new Date(a[2]+"/"+a[3]+"/"+a[4]),a=d.getFullYear()==Number(a[2])&&d.getMonth()+1==Number(a[3])&&d.getDate()==Number(a[4]))){a=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2];d="10X98765432".split("");for(e=c=0;17>e;e++)c+=b.substr(e,1)*a[e];return d[c%11]!=b.substr(17,1)?!1:!0}return!1}function isChinese1(b){b=String(b);return/^[\u4E00-\uFA29]+[\u00b7]?[\u4E00-\uFA29]+$/.test(b)};